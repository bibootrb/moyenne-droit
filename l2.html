<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CJLMQ5Y3RJ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-CJLMQ5Y3RJ');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ø¹Ø¯Ù„ÙŠ - Ø­Ù‚ÙˆÙ‚ (LMD) - Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</title>
    <style>
        :root {
            --primary-dark: #37474f;
            --accent-color: #0097a7;
            --light-bg: #f8f9fa;
            --white: #ffffff;
            --success: #2e7d32;
            --fail: #c62828;
            --warning: #fbc02d;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--light-bg);
            margin: 0;
            padding: 0;
            color: var(--primary-dark);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- Ø§Ù„Ù†Ø§Ù Ø¨Ø§Ø± Ø§Ù„Ù…Ø­Ø³Ù† --- */
        .navbar {
            background: var(--white);
            padding: 0 30px;
            height: 70px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #f4f4f4;
            position: fixed; top: 0; left: 0; width: 100%; box-sizing: border-box; 
            z-index: 1000;
            transition: top 0.4s ease-in-out;
        }
        .navbar.hidden { top: -100px; }

        .nav-brand {
            font-weight: 900; font-size: 1.4rem; color: #333;
            display: flex; align-items: center; gap: 8px; text-decoration: none;
            flex-shrink: 0;
        }

        .nav-links { display: flex; gap: 10px; align-items: center; }
        
        .social-link {
            text-decoration: none; color: #555; 
            display: flex; align-items: center; gap: 6px; padding: 10px;
            border-radius: 12px; transition: 0.3s; background: #f8f9fa;
        }
        .social-link:hover { background: #e0f2f1; color: var(--accent-color); }
        .icon-svg-mini { width: 22px; height: 22px; fill: currentColor; }
        .link-text { font-weight: 700; font-size: 0.85rem; }

        .menu-toggle {
            display: none; font-size: 1.5rem; cursor: pointer; color: var(--primary-dark);
            background: #f1f3f4; border: none; width: 45px; height: 45px;
            border-radius: 12px; align-items: center; justify-content: center;
        }

        @media (max-width: 768px) {
            .navbar { padding: 0 10px; height: 65px; justify-content: space-between; }
            .menu-toggle { display: flex; order: 1; margin: 0; }
            .nav-brand { order: 2; font-size: 1rem; margin: 0 auto; gap: 4px; }
            .nav-links { order: 3; gap: 5px; }
            .link-text { display: none; }
            .social-link { padding: 8px; background: transparent; }
            .icon-svg-mini { width: 24px; height: 24px; }
        }

        /* --- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© --- */
        .sidenav {
            height: 100%; width: 0; position: fixed; z-index: 2000;
            top: 0; right: 0; background-color: var(--white);
            overflow-x: hidden; transition: 0.4s; padding-top: 60px;
            box-shadow: -5px 0 15px rgba(0,0,0,0.1);
        }
        .sidenav a {
            padding: 15px 25px; text-decoration: none; font-size: 1.1rem;
            color: var(--primary-dark); display: block; transition: 0.3s; font-weight: 800;
            border-bottom: 1px solid #f9f9f9;
        }
        .sidenav a:hover { background: #f0f7f8; color: var(--accent-color); }
        .sidenav .closebtn { position: absolute; top: 10px; left: 15px; font-size: 30px; border: none; background: none; color: #888; }
        .sidenav-header { padding: 0 25px 15px; border-bottom: 1px solid #eee; margin-bottom: 10px; font-weight: 900; color: var(--accent-color); }

        .overlay {
            position: fixed; display: none; width: 100%; height: 100%;
            top: 0; left: 0; background: rgba(0,0,0,0.4); z-index: 1999; backdrop-filter: blur(3px);
        }

        .container {
            max-width: 650px; width: 95%; margin: 100px auto 30px auto;
            background: var(--white); border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.04); overflow: hidden; flex: 1;
        }

        .app-header { background-color: var(--primary-dark); padding: 25px; text-align: center; color: white; }
        .app-header h1 { margin: 0; font-size: 1.4rem; font-weight: 800; }
        .app-header p { margin: 8px 0 0; opacity: 0.8; font-size: 0.95rem; }

        .content-area { padding: 20px; }

        .dropdown { position: relative; margin-bottom: 15px; }
        .dropbtn {
            background: var(--light-bg); color: var(--primary-dark);
            padding: 14px 20px; border-radius: 50px; font-weight: 800;
            cursor: pointer; border: 1px solid #eee; display: flex; align-items: center; justify-content: space-between;
            font-size: 0.95rem; width: 100%; box-sizing: border-box;
        }
        .dropdown-content {
            display: none; width: 100%; background: white; box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            border-radius: 15px; overflow: hidden; border: 1px solid #eee; margin-top: 5px;
        }
        .dropdown-content a {
            color: var(--primary-dark); padding: 15px; text-decoration: none;
            display: block; font-weight: 700; border-bottom: 1px solid #f9f9f9; text-align: center;
        }
        .dropdown.active .dropdown-content { display: block; }

        .semester-select {
            width: 100%; padding: 12px; font-size: 1rem;
            border: 2px solid var(--accent-color); border-radius: 50px;
            background: white; color: var(--primary-dark);
            font-family: 'Tajawal', sans-serif; font-weight: bold;
            text-align: center; margin-bottom: 20px; cursor: pointer; outline: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%230097a7' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat; background-position: left 15px center; background-size: 16px;
        }

        .settings-box { background: #fffdeb; border: 1px solid #fbc02d; padding: 12px; border-radius: 10px; margin-bottom: 25px; text-align: center; }
        .radio-group { display: flex; justify-content: center; gap: 20px; margin-top: 8px; }
        .radio-group label { font-size: 0.9rem; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; }

        table { width: 100%; border-collapse: separate; border-spacing: 0 10px; min-width: 320px; }
        thead th { color: #90a4ae; padding: 10px 5px; font-size: 0.8rem; font-weight: 800; }
        td { padding: 8px 5px; text-align: center; border-bottom: 1px solid #f1f3f4; }
        td:first-child { text-align: right; font-weight: 700; width: 35%; font-size: 0.9rem; color: #455a64; }
        
        input[type="number"] {
            width: 100%; padding: 12px 0; text-align: center; border: 2px solid #eceff1; border-radius: 10px;
            font-size: 16px; font-weight: bold; outline: none; transition: 0.2s; background: #fff;
        }
        input:focus { border-color: var(--accent-color); transform: translateY(-2px); }

        #annual-section, #rescue-section { display: none; text-align: center; padding: 20px 0; }
        .annual-input-group { margin-bottom: 20px; }
        .annual-label { display: block; font-weight: bold; color: #546e7a; margin-bottom: 8px; }
        .annual-input { width: 80%; max-width: 200px; font-size: 1.2rem; padding: 15px; border: 2px solid #eceff1; border-radius: 15px; text-align: center; outline: none; }

        .buttons-area { display: flex; gap: 15px; margin-top: 25px; }
        button { border: none; padding: 18px; font-size: 1rem; border-radius: 12px; font-weight: 800; cursor: pointer; flex: 1; transition: 0.2s; }
        .btn-calc { flex: 2; background: var(--accent-color); color: white; }
        .btn-reset { background: #fff; color: var(--fail); border: 2px solid #ffcdd2; }
        
        .footer { background-color: var(--primary-dark); color: white; padding: 30px 20px; text-align: center; margin-top: auto; }
        .footer-link { color: #b0bec5; text-decoration: none; font-weight: bold; margin: 0 10px; }
        
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(55, 71, 79, 0.8); z-index: 2000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-overlay.active .modal-content { transform: scale(1); opacity: 1; }
        .modal-content { background: white; width: 90%; max-width: 380px; border-radius: 25px; padding: 0; overflow: hidden; transform: scale(0.9); opacity: 0; transition: 0.3s; }
        .result-header { padding: 30px; text-align: center; color: white; }
        .result-header.success { background: var(--success); }
        .result-header.fail { background: var(--fail); }
        .result-header.info { background: var(--accent-color); }
        .final-grade { font-size: 4.5rem; font-weight: 900; margin: 15px 0; color: var(--primary-dark); }
        .close-modal-btn { width: 100%; padding: 15px; background: #f1f3f5; border: none; font-weight: 800; cursor: pointer; }

        .score-good { background-color: #e8f5e9 !important; border-color: var(--success) !important; }
        .score-bad { background-color: #ffebee !important; border-color: var(--fail) !important; }
        .input-error { border-color: var(--fail) !important; background-color: #ffebee !important; animation: shake 0.3s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25%, 75% { transform: translateX(-4px); } }

		.link-image {
            display:block; max-width: 95%; margin: 20px auto; height: auto; border-radius: 12px; transition: transform 0.3s ease; cursor: pointer;
        }
        .link-image:hover { transform: scale(1.02); }
        .simple-caption { text-align: center; margin-top: 12px; margin-bottom: 25px; font-size: 0.8rem; color: var(--primary-dark); font-weight: 500; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
</head>
<body>

<nav class="navbar">
    <button class="menu-toggle" onclick="openNav()">â˜°</button>
    <a href="index.html" class="nav-brand">âš–ï¸ Ù…Ø¹Ø¯Ù„ÙŠ <span style="color: var(--accent-color);">Ø­Ù‚ÙˆÙ‚</span></a>
    <div class="nav-links">
        <a href="https://t.me/droitdzz" target="_blank" class="social-link">
            <svg class="icon-svg-mini" viewBox="0 0 24 24"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.743.051c-.033.004-.066.01-.098.015A12.01 12.01 0 0 0 11.944 0zM4.97 10.22l8.97-3.64a.75.75 0 0 1 .965.986l-2.47 8.27a.75.75 0 0 1-1.353.05L8.7 12.2l-2.91-1.12a.75.75 0 0 1-.82-1.86zm3.32 2.94 1.39 3.44.93-3.13-2.32-2.32.96-.38z"/></svg>
            <span class="link-text">ØªÙ„ØºØ±Ø§Ù…</span>
        </a>
        <a href="https://www.facebook.com/share/188gTChqTK/?mibextid=wwXIfr" target="_blank" class="social-link">
            <svg class="icon-svg-mini" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
            <span class="link-text">ÙÙŠØ³Ø¨ÙˆÙƒ</span>
        </a>
    </div>
</nav>

<div id="mySidenav" class="sidenav">
    <button class="closebtn" onclick="closeNav()">&times;</button>
    <div class="sidenav-header">ğŸ“ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</div>
    <a href="index.html">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <a href="index.html">ğŸ“œ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ (L1)</a>
    <a href="l2.html">âš–ï¸ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (L2)</a>
    <a href="soon.html">ğŸ›ï¸ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© (L3)</a>
</div>

<div id="overlay" class="overlay" onclick="closeNav()"></div>

<div class="container">
    <div class="app-header">
        <h1>Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ</h1>
        <p>Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø­Ù‚ÙˆÙ‚ (LMD)</p>
    </div>
	<a target="_blank">
        <img src="https://raw.githubusercontent.com/bibootrb/my-site-images/main/Banner.png" alt="Ø¨Ù†Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹" class="link-image">
    </a>

    <div class="content-area">
        <div class="dropdown" onclick="this.classList.toggle('active')">
            <div class="dropbtn">
                <span>ğŸ“ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</span>
                <span style="font-size: 0.7rem;">â–¼</span>
            </div>
            <div class="dropdown-content">
                <a href="index.html">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ (L1)</a>
                <a href="l2.html" style="background: #e0f2f1;">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (L2)</a>
                <a href="soon.html">Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© (L3)</a>
            </div>
        </div>

        <select id="semesterSelect" class="semester-select" onchange="updateSemester()">
            <option value="s1">ğŸ“ Ø§Ù„Ø³Ø¯Ø§Ø³ÙŠ Ø§Ù„Ø«Ø§Ù„Ø« (S3)</option>
            <option value="s2">âš–ï¸ Ø§Ù„Ø³Ø¯Ø§Ø³ÙŠ Ø§Ù„Ø±Ø§Ø¨Ø¹ (S4)</option>
            <option value="annual">ğŸ“… Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø³Ù†ÙˆÙŠ</option>
            <option value="rescue">ğŸ¯ Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ù‚Ø§Ø°</option>
        </select>

        <div id="settings-box" class="settings-box">
            <div style="font-size:0.9rem; font-weight:600; margin-bottom:5px;">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø­ØªØ³Ø§Ø¨: Ø­Ø³Ø¨ Ù†Ø¸Ø§Ù… Ø¬Ø§Ù…Ø¹ØªÙƒ</div>
            <div class="radio-group">
                <label><input type="radio" name="calcSystem" value="0.6" checked> 60/40</label>
                <label><input type="radio" name="calcSystem" value="0.5"> 50/50</label>
            </div>
        </div>

        <div id="table-wrapper">
            <table>
                <thead>
                    <tr><th>Ø§Ù„Ù…Ù‚ÙŠØ§Ø³</th><th width="15%">Ø§Ù„Ù…Ø¹Ø§Ù…Ù„</th><th>Ø§Ù…ØªØ­Ø§Ù†</th><th>TD</th></tr>
                </thead>
                <tbody id="modules-body"></tbody>
            </table>
        </div>

        <div id="annual-section">
            <div class="annual-input-group">
                <span class="annual-label">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø³Ø¯Ø§Ø³ÙŠ Ø§Ù„Ø«Ø§Ù„Ø« (S3)</span>
                <input type="number" id="avg-s1" class="annual-input" placeholder="00.00" step="0.01">
            </div>
            <div class="annual-input-group">
                <span class="annual-label">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø³Ø¯Ø§Ø³ÙŠ Ø§Ù„Ø±Ø§Ø¨Ø¹ (S4)</span>
                <input type="number" id="avg-s2" class="annual-input" placeholder="00.00" step="0.01">
            </div>
        </div>

        <div id="rescue-section">
            <div style="background: #e0f7fa; padding: 15px; border-radius: 12px; margin-bottom: 20px; font-size: 0.9rem;">Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø³Ø¯Ø§Ø³ÙŠ Ø§Ù„Ø«Ø§Ù„Ø« Ù„ØªØ¹Ø±Ù Ù…Ø§ ØªØ­ØªØ§Ø¬Ù‡ Ù„Ù„Ù†Ø¬Ø§Ø­ Ø§Ù„Ø³Ù†ÙˆÙŠ.</div>
            <div class="annual-input-group">
                <span class="annual-label">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø³Ø¯Ø§Ø³ÙŠ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø­Ø§Ù„ÙŠ</span>
                <input type="number" id="rescue-s1" class="annual-input" placeholder="00.00" step="0.01">
            </div>
        </div>

        <div class="buttons-area">
            <button id="reset-btn" class="btn-reset" onclick="resetFields()">Ù…Ø³Ø­</button>
            <button class="btn-calc" onclick="handleCalculation()">Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
        </div>

        <div id="tips-section" style="margin-top:30px; background:#f8f9fa; padding:15px; border-radius:10px; font-size:0.85rem; color:#78909c;">
            <div>âœï¸ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„ Ù„ØªØºÙŠÙŠØ±Ù‡.</div>
        </div>
		<a href="https://t.me/droitdzz" target="_blank" style="display:block; text-align:center; margin:20px auto;">
            <img src="https://cdn.jsdelivr.net/gh/bibootrb/my-site-images@main/IMG_2189.png" alt="ØµÙˆØ±Ø© ØªÙˆØ§ØµÙ„" style="max-width:650px; width:95%; height:auto; border-radius:12px;">
		</a>
		<div class="simple-caption">Ù„Ù„ØªÙˆØ§ØµÙ„ Ø£Ùˆ Ø§Ù„Ø¥Ø³ØªÙØ³Ø§Ø± ØªÙˆØ§ØµÙ„ÙˆØ§ Ù…Ø¹ÙŠ</div>
    </div>
</div>
	
<footer class="footer">
    <div style="margin-bottom:10px">
        <a href="https://t.me/droitdzz" class="footer-link">ØªÙ„ÙŠØ¬Ø±Ø§Ù…</a>
        <a href="https://www.facebook.com/share/188gTChqTK/?mibextid=wwXIfr" class="footer-link">ÙÙŠØ³Ø¨ÙˆÙƒ</a>
    </div>
    <div class="copyright">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© &copy; 2026</div>
</footer>

<div class="modal-overlay" id="resultModal" onclick="if(event.target.id==='resultModal')toggleModal(false)">
    <div class="modal-content">
        <div id="res-header" class="result-header">
            <div id="status-icon" style="font-size:3.5rem"></div>
            <div id="status-text" style="font-size:1.3rem; font-weight:bold"></div>
        </div>
        <div style="padding:30px; text-align:center">
            <div style="color:#546e7a; font-weight:bold" id="result-label">Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØµÙ„ÙŠ</div>
            <div id="final-avg" class="final-grade">00.00</div>
            <div id="mention-badge" style="background:#eceff1; padding:5px 15px; border-radius:20px; font-weight:bold">--</div>
            <div style="margin-top:15px; font-weight:bold; color:#546e7a">Ø±ØµÙŠØ¯: <span id="credit-text">---</span></div>
        </div>
        <button class="close-modal-btn" onclick="toggleModal(false)">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<script>
    function openNav() { document.getElementById("mySidenav").style.width = "280px"; document.getElementById("overlay").style.display = "block"; }
    function closeNav() { document.getElementById("mySidenav").style.width = "0"; document.getElementById("overlay").style.display = "none"; }

    const modulesL2 = [
        { name: "Ù‚Ø§Ù†ÙˆÙ† Ø¬Ù†Ø§Ø¦ÙŠ Ø¹Ø§Ù…", coeff: 2, credit: 6, hasTD: true },
        { name: "Ù‚Ø§Ù†ÙˆÙ† Ù…Ø¯Ù†ÙŠ", coeff: 2, credit: 6, hasTD: true },
        { name: "Ù‚Ø§Ù†ÙˆÙ† Ø¥Ø¯Ø§Ø±ÙŠ", coeff: 1, credit: 4, hasTD: true },
        { name: "Ù‚Ø§Ù†ÙˆÙ† Ø¯ÙˆÙ„ÙŠ Ø¹Ø§Ù…", coeff: 2, credit: 5, hasTD: false },
        { name: "Ù‚Ø§Ù†ÙˆÙ† ØªØ¬Ø§Ø±ÙŠ", coeff: 1, credit: 4, hasTD: false },
        { name: "ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ", coeff: 1, credit: 3, hasTD: true },
        { name: "Ù„ØºØ© Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©", coeff: 1, credit: 2, hasTD: false }
    ];

    let currentModules = modulesL2;
    let mode = 's1'; 

    function updateSemester() {
        mode = document.getElementById('semesterSelect').value;
        const table = document.getElementById('table-wrapper');
        const annual = document.getElementById('annual-section');
        const rescue = document.getElementById('rescue-section');
        const settings = document.getElementById('settings-box');
        const tips = document.getElementById('tips-section');
        const resetBtn = document.getElementById('reset-btn');

        table.style.display = 'none'; annual.style.display = 'none'; rescue.style.display = 'none';
        settings.style.display = 'none'; tips.style.display = 'none'; resetBtn.style.display = 'none';

        if (mode === 'annual') { annual.style.display = 'block'; }
        else if (mode === 'rescue') { rescue.style.display = 'block'; }
        else {
            table.style.display = 'block'; settings.style.display = 'block'; tips.style.display = 'block'; resetBtn.style.display = 'block';
            renderTable();
        }
    }

    function renderTable() {
        const tbody = document.getElementById('modules-body');
        tbody.innerHTML = currentModules.map((mod) => `
            <tr data-credit="${mod.credit}">
                <td>${mod.name}</td>
                <td><input type="number" class="coeff-input" value="${mod.coeff}"></td>
                <td><input type="number" class="exam-mark" placeholder="-" oninput="validateAndColor(this)"></td>
                <td>${mod.hasTD ? `<input type="number" class="td-mark" placeholder="-" oninput="validateAndColor(this)">` : `<input type="number" disabled style="background:#f8f9fa;" placeholder="Ã—">`}</td>
            </tr>
        `).join('');
    }

    function validateAndColor(input) {
        let val = parseFloat(input.value);
        input.classList.remove('score-good', 'score-bad', 'input-error');
        if (input.value === "") return;
        if (val > 20) input.classList.add('input-error');
        else if (val >= 10) input.classList.add('score-good');
        else input.classList.add('score-bad');
    }

    function handleCalculation() {
        if (mode === 'annual') calculateAnnual();
        else if (mode === 'rescue') calculateRescue();
        else calculateSemester();
    }

    function calculateSemester() {
        let examRatio = 0.6;
        document.getElementsByName('calcSystem').forEach(r => { if(r.checked) examRatio = parseFloat(r.value); });
        let tdRatio = (1 - examRatio).toFixed(1);
        let rows = document.querySelectorAll('#modules-body tr');
        let totalPoints = 0, totalCoeff = 0, partialCredit = 0;

        rows.forEach(row => {
            let coeff = parseFloat(row.querySelector('.coeff-input').value) || 1;
            let exam = parseFloat(row.querySelector('.exam-mark').value) || 0;
            let tdInput = row.querySelector('.td-mark');
            let moduleAvg = tdInput && !tdInput.disabled ? (exam * examRatio) + (parseFloat(tdInput.value || 0) * tdRatio) : exam;
            totalPoints += moduleAvg * coeff; totalCoeff += coeff;
            if (moduleAvg >= 10) partialCredit += parseFloat(row.getAttribute('data-credit'));
        });
        let finalAvg = totalPoints / totalCoeff;
        showResult(finalAvg, (finalAvg >= 10 ? 30 : partialCredit) + " / 30", "ÙØµÙ„ÙŠ");
    }

    function calculateAnnual() {
        let s3 = parseFloat(document.getElementById('avg-s1').value);
        let s4 = parseFloat(document.getElementById('avg-s2').value);
        if (isNaN(s3) || isNaN(s4)) { alert("Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø³Ø¯Ø§Ø³ÙŠÙŠÙ†"); return; }
        let annualAvg = (s3 + s4) / 2;
        showResult(annualAvg, (annualAvg >= 10 ? 60 : "---") + " / 60", "Ø³Ù†ÙˆÙŠ");
    }

    function calculateRescue() {
        let s3 = parseFloat(document.getElementById('rescue-s1').value);
        if (isNaN(s3)) { alert("Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø³Ø¯Ø§Ø³ÙŠ Ø§Ù„Ø«Ø§Ù„Ø«"); return; }
        let needed = (10 * 2) - s3;
        showResult(needed, "Ø§Ù„Ø³Ø¯Ø§Ø³ÙŠ Ø§Ù„Ø±Ø§Ø¨Ø¹", "Ù‡Ø¯Ù");
    }

    function showResult(avg, credit, type) {
        let header = document.getElementById('res-header');
        let icon = document.getElementById('status-icon');
        let badge = document.getElementById('mention-badge');
        let label = document.getElementById('result-label');
        
        label.innerText = type === "Ù‡Ø¯Ù" ? "Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„Ù†Ø¬Ø§Ø­" : "Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„" + type;
        document.getElementById('final-avg').innerText = avg.toFixed(2);
        document.getElementById('credit-text').innerText = credit;

        if (type === "Ù‡Ø¯Ù") {
            header.className = "result-header info"; icon.innerText = "ğŸ¯";
            badge.innerText = avg <= 10 ? "Ù…Ù‡Ù…Ø© Ø³Ù‡Ù„Ø©" : avg <= 12 ? "Ù…Ù…ÙƒÙ†Ø© Ø¨Ø§Ù„Ø§Ø¬ØªÙ‡Ø§Ø¯" : "ØªØ­Ø¯ÙŠ ÙƒØ¨ÙŠØ±";
        } else {
            if (avg < 10) { header.className = "result-header fail"; icon.innerText = "â˜¹"; badge.innerText = "Ø±Ø§Ø³Ø¨"; }
            else { header.className = "result-header success"; icon.innerText = "ğŸ‰"; badge.innerText = "Ù†Ø§Ø¬Ø­"; }
        }
        toggleModal(true);
    }

    function toggleModal(show) {
        let m = document.getElementById('resultModal');
        if(show) { m.style.display="flex"; setTimeout(()=>m.classList.add('active'),10); }
        else { m.classList.remove('active'); setTimeout(()=>m.style.display="none",300); }
    }

    function resetFields() {
        document.querySelectorAll('input[type="number"]:not(.coeff-input)').forEach(i => { i.value=""; i.classList.remove('score-good','score-bad','input-error'); });
    }

    renderTable(); 
</script>
</body>
</html>

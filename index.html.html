<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ø¹Ø¯Ù„ÙŠ - Ø­Ù‚ÙˆÙ‚</title>
    <style>
        :root {
            --primary-dark: #37474f;
            --accent-color: #0097a7;
            --light-bg: #eceff1;
            --white: #ffffff;
            --success: #2e7d32;
            --fail: #c62828;
            --warning: #fbc02d;
            
            /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ */
            --telegram: #0088cc;
            --facebook: #1877f2;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--light-bg);
            margin: 0;
            padding: 0; /* ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¨Ø§Ø¯ÙŠÙ†Ø¬ Ù„ÙŠØºØ·ÙŠ Ø§Ù„Ù†Ø§Ù Ø¨Ø§Ø± Ø§Ù„Ø´Ø§Ø´Ø© */
            color: var(--primary-dark);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- ØªØµÙ…ÙŠÙ… Ø§Ù„Ù†Ø§Ù Ø¨Ø§Ø± (Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ) --- */
        .navbar {
            background-color: var(--white);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-brand {
            font-weight: 800;
            font-size: 1.2rem;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .nav-links {
            display: flex;
            gap: 15px;
        }

        .social-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: bold;
            transition: transform 0.2s;
        }
        .social-btn:active { transform: scale(0.95); }
        
        .btn-telegram { background-color: #e3f2fd; color: var(--telegram); }
        .btn-facebook { background-color: #e8f5fe; color: var(--facebook); }
        
        .icon-svg { width: 18px; height: 18px; fill: currentColor; }

        /* --- Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© --- */
        .container {
            max-width: 650px;
            width: 90%; /* Ù„Ø¶Ø¨Ø· Ø§Ù„Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆØ§ØªÙ */
            margin: 30px auto;
            background: var(--white);
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            overflow: hidden;
            flex: 1; /* Ù„Ø¬Ø¹Ù„ Ø§Ù„ÙÙˆØªØ± ÙŠÙ†Ø²Ù„ Ù„Ù„Ø£Ø³ÙÙ„ Ø¯Ø§Ø¦Ù…Ø§Ù‹ */
        }

        /* Ø§Ù„Ø±Ø£Ø³ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù„Ù„Ø¨Ø·Ø§Ù‚Ø© */
        .app-header {
            background-color: var(--primary-dark);
            padding: 20px;
            text-align: center;
            color: white;
        }
        .app-header h1 { margin: 0; font-size: 1.4rem; font-weight: 700; }
        .app-header p { margin: 5px 0 0; opacity: 0.8; font-size: 0.9rem; }

        .content-area { padding: 20px; }

        /* Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
        .settings-box {
            background: #fffdeb;
            border: 1px solid #fbc02d;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        .radio-group { display: flex; justify-content: center; gap: 15px; margin-top: 5px; }
        .radio-group label { font-size: 0.9rem; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 5px; color: var(--primary-dark); }
        
        /* Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
        .table-wrapper { width: 100%; overflow-x: auto; margin-bottom: 15px; }
        table { width: 100%; border-collapse: separate; border-spacing: 0 8px; min-width: 340px; }
        
        thead th { color: #78909c; padding: 8px 5px; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; border: none; }
        .en-sub { display: block; font-size: 0.6rem; color: #b0bec5; font-weight: normal; margin-top: 2px; }

        td { padding: 5px; text-align: center; vertical-align: middle; border-bottom: 1px solid #f1f3f4; }
        td:first-child { text-align: right; padding-right: 10px; font-weight: 700; color: var(--primary-dark); font-size: 0.9rem; }
        
        input[type="number"] {
            width: 100%; padding: 10px 0; text-align: center; border: 1px solid #cfd8dc; border-radius: 8px;
            font-size: 16px; outline: none; transition: 0.2s; inputmode: decimal; font-weight: bold; background: #fff; color: var(--primary-dark);
        }
        input[type="number"]:focus { border-color: var(--accent-color); box-shadow: 0 2px 8px rgba(0, 151, 167, 0.1); }
        input:disabled { background: #f5f5f5; border-color: transparent; }

        .score-good { color: var(--success) !important; background-color: #e8f5e9 !important; border-color: var(--success) !important; }
        .score-bad { color: var(--fail) !important; background-color: #ffebee !important; border-color: var(--fail) !important; }
        .input-error { border-color: var(--fail) !important; background-color: #ffebee !important; animation: shake 0.3s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25%, 75% { transform: translateX(-4px); } }

        .coeff-input { width: 40px !important; background: transparent !important; border: none !important; border-bottom: 2px dashed #b0bec5 !important; border-radius: 0 !important; color: #78909c; }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .buttons-area { display: flex; gap: 10px; margin-top: 20px; }
        button { border: none; padding: 16px; font-size: 1rem; border-radius: 10px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button:active { transform: scale(0.98); }
        .btn-calc { flex: 2; background: var(--accent-color); color: white; }
        .btn-reset { flex: 1; background: #fff; color: var(--fail); border: 1px solid #ffcdd2; }

        /* Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª */
        .tips-section { margin-top: 30px; background: #f4f6f8; padding: 20px; border-radius: 12px; }
        .tip-item { display: flex; gap: 10px; margin-bottom: 10px; align-items: flex-start; }
        .tip-icon { font-size: 1.2rem; }
        .tip-text { font-size: 0.85rem; color: #607d8b; line-height: 1.5; }
        .tip-title { font-weight: 800; color: var(--primary-dark); display: block; }

        /* --- ØªØµÙ…ÙŠÙ… Ø§Ù„ÙÙˆØªØ± (Ø§Ù„Ø°ÙŠÙ„) --- */
        .footer {
            background-color: var(--primary-dark);
            color: white;
            padding: 30px 20px;
            text-align: center;
            margin-top: auto; /* ÙŠØ¯ÙØ¹Ù‡ Ù„Ù„Ø£Ø³ÙÙ„ */
        }
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
        }
        .footer-link { color: #b0bec5; text-decoration: none; font-size: 0.9rem; transition: 0.2s; }
        .footer-link:hover { color: white; }
        .copyright { font-size: 0.8rem; opacity: 0.6; }


        /* --- Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px);
            z-index: 1000; display: none; justify-content: center; align-items: center; padding: 20px;
        }
        .modal-overlay.active .modal-content { transform: scale(1); opacity: 1; }
        
        .modal-content {
            background: white; width: 100%; max-width: 360px; border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25); position: relative; overflow: hidden;
            transform: scale(0.9); opacity: 0; transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .result-header {
            padding: 20px; text-align: center; color: white;
            display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 10px;
        }
        .result-header.success { background-color: var(--success); }
        .result-header.fail { background-color: var(--fail); }
        
        .status-icon { font-size: 3rem; line-height: 1; }
        .status-text { font-size: 1.1rem; font-weight: bold; letter-spacing: 0.5px; }

        .result-body { padding: 25px 20px; text-align: center; }
        
        .grade-label { font-size: 0.85rem; color: #90a4ae; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }
        .final-grade { font-size: 4rem; font-weight: 800; line-height: 1; margin: 10px 0; color: var(--primary-dark); }
        
        .mention-badge {
            display: inline-block; padding: 6px 16px; border-radius: 50px;
            background: #eceff1; color: var(--primary-dark); font-weight: bold; font-size: 1rem;
            margin-bottom: 20px;
        }

        .credit-section { background: #f9fafb; border-radius: 12px; padding: 15px; border: 1px solid #eceff1; }
        .credit-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-weight: bold; color: var(--primary-dark); font-size: 0.9rem; }
        .progress-bg { height: 8px; background: #e0e0e0; border-radius: 10px; overflow: hidden; }
        .progress-bar { height: 100%; width: 0%; transition: width 1s ease; border-radius: 10px; }

        .modal-footer { padding: 0 20px 20px; }
        .close-modal-btn {
            width: 100%; padding: 15px; border: none; background: #f1f3f5; color: var(--primary-dark);
            font-weight: bold; font-size: 1rem; border-radius: 12px; cursor: pointer; transition: 0.2s;
        }
        .close-modal-btn:hover { background: #e9ecef; }
        
        /* Ø¥Ø®ÙØ§Ø¡ Ù†ØµÙˆØµ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ù‡ÙˆØ§ØªÙ Ø§Ù„ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ */
        @media (max-width: 350px) {
            .btn-text { display: none; }
        }

    </style>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
</head>
<body>

<nav class="navbar">
    <div class="nav-brand">
        âš–ï¸ Ù…Ø¹Ø¯Ù„ÙŠ
    </div>
    <div class="nav-links">
        <a href="https://t.me/droitdzz" target="_blank" class="social-btn btn-telegram">
            <svg class="icon-svg" viewBox="0 0 24 24"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.743.051c-.033.004-.066.01-.098.015A12.01 12.01 0 0 0 11.944 0zM4.97 10.22l8.97-3.64a.75.75 0 0 1 .965.986l-2.47 8.27a.75.75 0 0 1-1.353.05L8.7 12.2l-2.91-1.12a.75.75 0 0 1-.82-1.86zm3.32 2.94 1.39 3.44.93-3.13-2.32-2.32.96-.38z"/></svg>
            <span class="btn-text">Ù…Ù„Ø®ØµØ§Øª</span>
        </a>
        <a href="https://facebook.com/Ø¶Ø¹_Ø±Ø§Ø¨Ø·_ÙÙŠØ³Ø¨ÙˆÙƒ_Ù‡Ù†Ø§" target="_blank" class="social-btn btn-facebook">
            <svg class="icon-svg" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
            <span class="btn-text">ÙÙŠØ³Ø¨ÙˆÙƒ</span>
        </a>
    </div>
</nav>

<div class="container">
    <div class="app-header">
        <h1>Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ - Ø§Ù„Ø³Ø¯Ø§Ø³ÙŠ Ø§Ù„Ø§ÙˆÙ„</h1>
        <p>Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø­Ù‚ÙˆÙ‚ (Ù†Ø¸Ø§Ù… LMD)</p>
    </div>

    <div class="content-area">
        <div class="settings-box">
            <div style="font-size:0.95rem; color: var(--primary-dark); margin-bottom:8px; font-weight:800;">Ø·Ø±ÙŠÙ‚Ø© Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø­Ø³Ø¨ Ø¬Ø§Ù…Ø¹ØªÙƒ:</div>
            <div class="radio-group">
                <label><input type="radio" name="calcSystem" value="0.6" checked> 60% Ø§Ù…ØªØ­Ø§Ù† + 40% TD</label>
                <label><input type="radio" name="calcSystem" value="0.5"> 50% Ø§Ù…ØªØ­Ø§Ù† + 50% TD</label>
            </div>
        </div>

        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th width="35%">Ø§Ù„Ù…Ø§Ø¯Ø© <span class="en-sub">Module</span></th>
                        <th width="15%">Ø§Ù„Ù…Ø¹Ø§Ù…Ù„ <span class="en-sub">Coeff</span></th>
                        <th width="25%">Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† <span class="en-sub">Exam</span></th>
                        <th width="25%">Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ <span class="en-sub">TD</span></th>
                    </tr>
                </thead>
                <tbody id="modules-body"></tbody>
            </table>
        </div>

        <div class="buttons-area">
            <button class="btn-reset" onclick="resetFields()">Ù…Ø³Ø­ Ø§Ù„Ø®Ø§Ù†Ø§Øª</button>
            <button class="btn-calc" onclick="calculateFinal()">Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„</button>
        </div>

        <div class="tips-section">
            <div class="tip-item">
                <span class="tip-icon">âœï¸</span>
                <span class="tip-text"><span class="tip-title">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª:</span> Ø®Ø§Ù†Ø© "Ø§Ù„Ù…Ø¹Ø§Ù…Ù„" Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù… Ù„ØªØºÙŠÙŠØ±Ù‡ Ø­Ø³Ø¨ Ø¬Ø§Ù…Ø¹ØªÙƒ.</span>
            </div>
            <div class="tip-item">
                <span class="tip-icon">ğŸš¨</span>
                <span class="tip-text"><span class="tip-title">ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ø§Ù…:</span> Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø± ÙŠØ¹Ù†ÙŠ Ø£Ù†Ùƒ Ø£Ø¯Ø®Ù„Øª Ù†Ù‚Ø·Ø© Ø®Ø§Ø·Ø¦Ø© (Ø£ÙƒØ¨Ø± Ù…Ù† 20).</span>
            </div>
            <div class="tip-item">
                <span class="tip-icon">ğŸ¯</span>
                <span class="tip-text"><span class="tip-title">Ø§Ù„Ø±ØµÙŠØ¯:</span> Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ø¯Ù„ 10 ÙÙ…Ø§ ÙÙˆÙ‚ ÙŠÙ…Ù†Ø­Ùƒ 30 Ø±ØµÙŠØ¯Ø§Ù‹ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.</span>
            </div>
        </div>
    </div>
</div>

<footer class="footer">
    <div class="footer-links">
        <a href="https://t.me/droitdzz" class="footer-link">Ù‚Ù†Ø§Ø© Ø§Ù„Ù…Ù„Ø®ØµØ§Øª</a>
        <a href="https://facebook.com/Ø¶Ø¹_Ø±Ø§Ø¨Ø·_ÙÙŠØ³Ø¨ÙˆÙƒ_Ù‡Ù†Ø§" class="footer-link">ØµÙØ­Ø© Ø§Ù„ÙÙŠØ³Ø¨ÙˆÙƒ</a>
    </div>
    <div class="copyright">
        Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©&copy; 2026
    </div>
</footer>

<div class="modal-overlay" id="resultModal" onclick="closeModal(event)">
    <div class="modal-content">
        <div id="res-header" class="result-header">
            <div id="status-icon" class="status-icon"></div>
            <div id="status-text" class="status-text"></div>
        </div>

        <div class="result-body">
            <div class="grade-label">Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„ÙØµÙ„ÙŠ</div>
            <div id="final-avg" class="final-grade">00.00</div>
            <div id="mention-badge" class="mention-badge">--</div>

            <div class="credit-section">
                <div class="credit-row">
                    <span>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ÙƒØªØ³Ø¨</span>
                    <span id="credit-text">0 / 30</span>
                </div>
                <div class="progress-bg">
                    <div id="credit-bar" class="progress-bar"></div>
                </div>
            </div>
        </div>

        <div class="modal-footer">
            <button class="close-modal-btn" onclick="toggleModal(false)">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>
</div>

<script>
    const modules = [
        { name: "Ù…Ø¯Ø®Ù„ Ù„Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©", coeff: 2, credit: 7, hasTD: true },
        { name: "Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ø¯Ø³ØªÙˆØ±ÙŠ", coeff: 2, credit: 7, hasTD: true },
        { name: "Ù…Ø¬ØªÙ…Ø¹ Ø¯ÙˆÙ„ÙŠ", coeff: 1, credit: 3, hasTD: false },
        { name: "Ø§Ù„ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ù‚Ø¶Ø§Ø¦ÙŠ", coeff: 1, credit: 4, hasTD: true },
        { name: "ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø¸Ù…", coeff: 1, credit: 3, hasTD: false },
        { name: "Ù…Ù†Ù‡Ø¬ÙŠØ©", coeff: 1, credit: 4, hasTD: false },
        { name: "Ù…ØµØ·Ù„Ø­Ø§Øª", coeff: 1, credit: 2, hasTD: false }
    ];

    const tbody = document.getElementById('modules-body');

    function renderTable() {
        tbody.innerHTML = '';
        modules.forEach((mod) => {
            let tdInput = mod.hasTD 
                ? `<input type="number" class="td-mark" placeholder="-" inputmode="decimal" step="0.01" oninput="validateAndColor(this)">` 
                : `<input type="number" disabled placeholder="Ã—">`;
            
            let row = `
                <tr data-credit="${mod.credit}">
                    <td>${mod.name}</td>
                    <td><input type="number" class="coeff-input" value="${mod.coeff}" inputmode="decimal"></td>
                    <td><input type="number" class="exam-mark" placeholder="-" inputmode="decimal" step="0.01" oninput="validateAndColor(this)"></td>
                    <td>${tdInput}</td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }

    function validateAndColor(input) {
        let val = parseFloat(input.value);
        input.classList.remove('score-good', 'score-bad', 'input-error');
        if (input.value === "") return;

        if (val > 20 || val < 0) {
            input.classList.add('input-error');
        } else {
            if (val >= 10) input.classList.add('score-good'); // Ø£Ø®Ø¶Ø±
            else input.classList.add('score-bad'); // Ø£Ø­Ù…Ø±
        }
    }

    function calculateFinal() {
        let errorInputs = document.querySelectorAll('.input-error');
        if (errorInputs.length > 0) { alert("ØªÙ†Ø¨ÙŠÙ‡: ØªÙˆØ¬Ø¯ Ù†Ù‚Ø§Ø· Ø£ÙƒØ¨Ø± Ù…Ù† 20!"); return; }

        let filledInputs = document.querySelectorAll('.exam-mark');
        let hasData = false;
        filledInputs.forEach(input => { if(input.value !== "") hasData = true; });
        if(!hasData) { alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹."); return; }

        const radios = document.getElementsByName('calcSystem');
        let examRatio = 0.6; 
        let tdRatio = 0.4;
        for (const radio of radios) { if (radio.checked) { examRatio = parseFloat(radio.value); tdRatio = (1 - examRatio).toFixed(1); break; } }

        let rows = document.querySelectorAll('#modules-body tr');
        let totalPoints = 0;
        let totalCoeff = 0;
        let partialCredit = 0;

        rows.forEach(row => {
            let coeff = parseFloat(row.querySelector('.coeff-input').value) || 1;
            let creditVal = parseFloat(row.getAttribute('data-credit')) || 0;
            let exam = parseFloat(row.querySelector('.exam-mark').value) || 0;
            let tdInput = row.querySelector('.td-mark');
            
            let moduleAvg = 0;
            if (tdInput && !tdInput.disabled) {
                let td = parseFloat(tdInput.value) || 0;
                moduleAvg = (exam * examRatio) + (td * tdRatio);
            } else {
                moduleAvg = exam;
            }

            totalPoints += moduleAvg * coeff;
            totalCoeff += coeff;
            if (moduleAvg >= 10) partialCredit += creditVal;
        });

        let finalAvg = totalCoeff > 0 ? (totalPoints / totalCoeff) : 0;
        let finalCredit = (finalAvg >= 10) ? 30 : partialCredit;

        showResultModal(finalAvg, finalCredit);
    }

    function showResultModal(avg, credit) {
        let header = document.getElementById('res-header');
        let icon = document.getElementById('status-icon');
        let statusText = document.getElementById('status-text');
        let avgEl = document.getElementById('final-avg');
        let mentionBadge = document.getElementById('mention-badge');
        let creditText = document.getElementById('credit-text');
        let creditBar = document.getElementById('credit-bar');

        avgEl.innerText = avg.toFixed(2);
        creditText.innerText = `${credit} / 30`;

        let mention = "";
        let barColor = "";

        if (avg < 10) {
            header.className = "result-header fail";
            icon.innerText = "â˜¹"; 
            statusText.innerText = "Ø±Ø§Ø³Ø¨ (AjournÃ©)";
            mention = "Ù„Ù„Ø£Ø³Ù";
            barColor = (credit >= 15) ? "#fbc02d" : "#d32f2f"; 
            mentionBadge.style.color = "#d32f2f";
            mentionBadge.style.background = "#ffebee";
        } else {
            header.className = "result-header success";
            icon.innerText = "ğŸ‰";
            statusText.innerText = "Ù†Ø§Ø¬Ø­ (Admis)";
            
            if (avg < 12) mention = "Ù…Ù‚Ø¨ÙˆÙ„";
            else if (avg < 14) mention = "Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ø¬ÙŠØ¯";
            else if (avg < 16) mention = "Ø¬ÙŠØ¯";
            else mention = "Ù…Ù…ØªØ§Ø²";

            barColor = "#2e7d32"; // Ø£Ø®Ø¶Ø±
            mentionBadge.style.color = "#2e7d32";
            mentionBadge.style.background = "#e8f5e9";
        }

        mentionBadge.innerText = mention;
        creditBar.style.backgroundColor = barColor;
        
        toggleModal(true);
        setTimeout(() => {
            let width = (credit / 30) * 100;
            creditBar.style.width = `${width}%`;
        }, 300);
    }

    function toggleModal(show) {
        let modal = document.getElementById('resultModal');
        if (show) {
            modal.style.display = "flex";
            setTimeout(() => modal.classList.add('active'), 10);
        } else {
            modal.classList.remove('active');
            setTimeout(() => modal.style.display = "none", 300);
            document.getElementById('credit-bar').style.width = "0%";
        }
    }

    function closeModal(event) {
        if (event.target.id === 'resultModal') toggleModal(false);
    }

    function resetFields() {
        if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·ØŸ")) {
            document.querySelectorAll('input[type="number"]:not(.coeff-input)').forEach(i => {
                i.value = "";
                i.classList.remove('score-good', 'score-bad', 'input-error');
            });
        }
    }

    renderTable();
</script>

</body>
</html>
